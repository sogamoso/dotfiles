#!/usr/bin/env bash
set -euo pipefail

REPO_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Install Omamac if not already present (Rectangle Pro is a reliable Omamac signal)
if ! brew list --cask rectangle-pro &>/dev/null 2>&1; then
  curl -fsSL https://omamac.org/install | bash
fi

# Personal layer
case "$(uname -s)" in
  Darwin)
    bash "$REPO_DIR/install/macos/all.sh"
    ;;
  *)
    echo "Unsupported OS"
    exit 1
    ;;
esac

# Stow personal configs
bash "$REPO_DIR/install/stow.sh"

# Tailscale
if ! tailscale status &>/dev/null; then
  echo "Tailscale is not connected. Run: tailscale up --ssh"
fi

exec zsh -l
